#include os_detection.inc;
var debug = false;
// **************************************************************************************							 
function alert(fname, version)
{	
	var ri = new TReportItem();
	ri.LoadFromFile(fname);
	ri.affects = "Web Server";
	ri.Details =  "Current version is : [dark]" + version + "[/dark]";
	AddReportItem(ri);	
}							 
/***********************************************************************************/
/* main entry point */
// php tests
if (isPHP)
{
	var m = null;
	
	m = /.*(PHP\/4\.3\.9\s)/.exec(poweredby);
	if (m) alert('PHP_4.3.9_remote_code_execution.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/4\.3\.0\s)/.exec(poweredby);
	if (m) alert('PHP_4.3.0_file_disclosure_and_possible_code_execution.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/3\.0\.((1[0-6])|([0-9]))\s|(.*PHP\/4\.0\.[0-2]\s))/.exec(poweredby);
	if (m) alert('PHP_error_logging_format_string_vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(4\.([0-3]\.\d*|4\.[0-4])|5\.(0\.\d*|1\.[0-6])))\s/.exec(poweredby);
	if (m) alert('PHP_HTML_Entity_Encoder_Heap_Overflow_Vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/4\.2\.[01]\s)/.exec(poweredby);
	if (m) alert('PHP_HTTP_POST_incorrect_MIME_header_parsing_vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/([0-3]\..*\s|4\.[0-1]\..*\s|4\.2\.[0-2]\s))/.exec(poweredby);
	if (m) alert('PHP_Mail_Function_ASCII_Control_Character_Header_Spoofing_Vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(5\.[0-2]\.\d+|5\.3\.[0]))\-[^\s]*\s/.exec(poweredby);
	if (m) alert('PHP_multipart_form-data_denial_of_service.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(4\.([0-2]\.\d*|3\.[0-9])|5\.0\.[012]))\s/.exec(poweredby);
	if (m) alert('PHP_multiple_vulnerabilities_.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/((3.*\s)|(4\.0.*\s)|(4\.1\.[01].*\s)))/.exec(poweredby);
	if (m) alert('PHP_POST_file_upload_buffer_overflow_vulnerabilities.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/5\.5\.0\s)/.exec(poweredby);
	if (m) alert('PHP_Safedir_Restriction_Bypass_Vulnerabilities.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/([1-3]\..*\s|4\.([0-2]\..*\s|3\.[0-1]\s)))/.exec(poweredby);
	if (m) alert('PHP_socket_iovec_alloc()_integer_overflow.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/4\.3\.[0-2])\s/.exec(poweredby);
	if (m) alert('PHP_Undefined_Safe_Mode_Include_Dir_Safemode_Bypass_Vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(4\.([0-2]\.\d*|3\.[0-8])|5\.0\.[01]))\s/.exec(poweredby);
	if (m) alert('PHP_unspecified_remote_arbitrary_file_upload_vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/3\.0\.((1[0-6])|([0-9]))\s|(.*PHP\/4\.0\.[0-2]\s))/.exec(poweredby);
	if (m) alert('PHP_upload_arbitrary_file_disclosure_vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/4\.3\.[0-7][^0-9])/.exec(poweredby);
	if (m) alert('PHP_version_older_4.3.8.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(4\.([0-2]\.\d*|3\.[0-8]|4\.0)))\s/.exec(poweredby);
	if (m) alert('PHP_version_older_than_4.4.1.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(5\.[0-1]\.\d+|5\.2\.0))\s/.exec(poweredby);
	if (m) alert('PHP_version_older_than_5.2.1.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(5\.[0-1]\.\d+|5\.2\.[0-2]))\s/.exec(poweredby);
	if (m) alert('PHP_version_older_than_5.2.3.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(5\.[0-1]\.\d+|5\.2\.[0-4]))\s/.exec(poweredby);
	if (m) alert('PHP_version_older_than_5.2.5.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(5\.[0-1]\.\d+|5\.2\.[0-5]))\s/.exec(poweredby);
	if (m) alert('PHP_version_older_than_5.2.6.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(5\.2\.7))\s/.exec(poweredby);
	if (m) alert('PHP_version_older_than_5.2.8.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/(4\.([0-3]\.\d*|4\.[0-2])|5\.(0\.\d*|1\.[0-3])))\s/.exec(poweredby);
	if (m) alert('PHP_Zend_Hash_Del_Key_Or_Index_vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/4\.0\.[0-3]\s)/.exec(poweredby);
	if (m) alert('PHP4_IMAP_module_buffer_overflow_vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/4\.([0-2]\..*\s|3\.[0-2]\s))/.exec(poweredby);
	if (m) alert('PHP4_Multiple_Vulnerabilities.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/5\.([23])\.([0-9]+))/.exec(poweredby);
	if (m){
		if(m[2]==2 && parseInt(m[3])<17) alert('PHP_hang_on_number_parsing.xml', m[1]);
		else 
		if(m[2]==3 && parseInt(m[3])<5) alert('PHP_hang_on_number_parsing.xml', m[1]);
	}
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(PHP\/5\.([45])\.([0-9]+))/.exec(poweredby);
	if (m){
		if(m[2]==4 && parseInt(m[3])<28) alert('PHP_5428_5512.xml', m[1]);
		else 
		if(m[2]==5 && parseInt(m[3])<12) alert('PHP_5428_5512.xml', m[1]);
	}
	/*-----------------------------------------------------------------------------------------------------------*/		
}
// apache tests
if (isApache)
{
	var m = null;
	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.2\.(0|2|3|4|5|6|8|9|1[0-3])\s).*(Win32)/.exec(banner);
	if (m) alert('Apache_2.2.14_mod_isapi_Dangling_Pointer.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.51)\s/.exec(banner);
	if (m) alert('Apache_version_equal_to_2.0.51.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.([0-9]\s|[0-3][0-9]\s|4[0-2]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.0.43.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.([0-9]\s|[0-3][0-9]\s|4[0-4]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.0.45.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.([0-9]\s|[0-3][0-9]\s|4[0-5]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.0.46.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.([0-9]\s|[0-3][0-9]\s|4[0-6]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.0.47.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.([0-9]\s|[0-3][0-9]\s|4[0-7]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.0.48.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.(3[5-9]\s|4[0-8]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.0.49.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.(3[5-9]\s|4[0-9]\s|5[0]\s))/.exec(banner);
	if (m) alert('Apache_version_older_than_2.0.51.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.(3[5-9]\s|4[0-8]\s|5[0-4]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.0.55.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.(3[5-9]\s|4[0-9]\s|5[0-9]\s|6[0]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.0.61.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.0\.(3[5-9]\s|4[0-9]\s|5[0-9]\s|6[0-2]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.0.63.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.2\.(0|2|3|4|5|6|8|9)\s)/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.2.10.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.2\.([0-2]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.2.3.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.2\.([0-5]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.2.6.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.2\.([0-7]\s))/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.2.8.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/2\.2\.(0|2|3|4|5|6|8)\s)/.exec(banner);
	if (m) alert('Apache_2.x_version_older_than_2.2.9.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9]\s|3\.([0-9]\s|[0-1][0-9]|2[0-5]\s))|2\.0.([0-9]\s|[0-2][0-9]|3[0-8]\s)))/.exec(banner);
	if (m) alert('Apache_Chunked-Encoding_Memory_Corruption_Vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9]|3\.([0-9][^0-9]|[0-2][0-9]))|2\.0.([0-9][^0-9]|[0-3][0-9]|4[0-8])))/.exec(banner);
	if (m) alert('Apache_Error_Log_Escape_Sequence_Injection_Vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/((1\.3\.(2[8-9]|3[0-6])\s)|(2\.0.(4[6-9]|5[0-8])\s)|(2\.2.[0-2]\s)))/.exec(banner);
	if (m) alert('Apache_Mod_Rewrite_Off-By-One_Buffer_Overflow_Vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9].\s|3\.([0-9]\s|[0-1][0-9]\s|2[0-6]\s))))/.exec(banner);
	if (m) alert('Apache_version_older_than_1.3.27.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9].\s|3\.([0-9]\s|[0-1][0-9]\s|2[0-7]\s))))/.exec(banner);
	if (m) alert('Apache_version_older_than_1.3.28.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9].\s|3\.([0-9]\s|[0-1][0-9]\s|2[0-8]\s))))/.exec(banner);
	if (m) alert('Apache_version_older_than_1.3.29.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9].\s|3\.([0-9]\s|[0-2][0-9]\s|3[0]\s))))/.exec(banner);
	if (m) alert('Apache_version_older_than_1.3.31.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9].\s|3\.([0-9]\s|[0-2][0-9]\s|3[0-3]\s))))/.exec(banner);
	if (m) alert('Apache_version_older_than_1.3.34.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9].\s|3\.([0-9]\s|[0-2][0-9]\s|3[0-6]\s))))/.exec(banner);
	if (m) alert('Apache_version_older_than_1.3.37.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9].\s|3\.([0-9]\s|[0-2][0-9]\s|3[0-8]\s))))/.exec(banner);
	if (m) alert('Apache_version_older_than_1.3.39.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9].\s|3\.([0-9]\s|[0-3][0-9]\s|4[0]\s))))/.exec(banner);
	if (m) alert('Apache_version_older_than_1.3.41.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9].\s|3\.([0-9]\s|[0-2][0-9]\s|3[0-3]\s))))/.exec(banner);
	if (m) alert('Apache_version_up_to_1.3.33_htpasswd_local_overflow.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /.*(Apache(-AdvancedExtranetServer)?\/(1\.([0-2]\.[0-9]\s|3\.([0-9]\s|[0-1][0-9]|2[0-5]\s))|2\.0.([0-9]\s|[0-5][0-9]|6[0-4]\s))|2\.2.([0-9]\s|[0-1][0-9]\s))/.exec(banner);
	if (m) alert('Apache_httpd_Remote_Denial_of_Service.xml', m[1]);
}
// apache tomcat tests
if (isTomcat)
{
	var m = null;
	
	m = /(Apache\sTomcat\/(6\.0\.([0-9]\s|1[0-9])|(5\.5\.([0-9]\s|1[0-9]|2[0-8]))\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_Directory_Host_Appbase_Authentication_Bypass_Vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/4\.1\.([0-2][0-9]\s|3[0-6]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_4.1.37.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/4\.1\.([0-2][0-9]\s|3[0-7]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_4.1.39.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/5\.5\.([0-1][0-9]\s|2[0-4]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_5.5.25.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/5\.5\.([0-1][0-9]\s|2[0-5]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_5.5.26.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/5\.5\.([0-1][0-9]\s|2[0-6]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_5.5.27.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/6\.0\.([0-9]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_6.0.10.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/6\.0\.([0-9]\s|10\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_6.0.11.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/6\.0\.([0-9]\s|1[0-3]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_6.0.14.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/6\.0\.([0-9]\s|1[0-5]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_6.0.16.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/6\.0\.([0-9]\s|1[0-6]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_6.0.18.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/6\.0\.([0-5]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_6.0.6.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/6\.0\.([0-8]\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_version_older_than_6.0.9.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(Apache\sTomcat\/(6\.0\.([0-9]\s|1[0-9])|(5\.5\.([0-9]\s|1[0-9]|2[0-8]))\s))/.exec(banner);
	if (m) alert('Apache_Tomcat_WAR_File_Directory_Traversal_Vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
}	
// nginx tests
if (isNginx)
{
	var m = null;
	
	m = /(nginx\/((0.1\..*\s)|(0.2\..*\s)|(0.3\..*\s)|(0.4\..*\s)|0\.5\.(\d\s|[0-2]\d?\s|3[0-7]))|0\.6\.(\d\s|[0-2]\d?\s|3[0-8])|0\.7\.(\d\s|[0-5]\d?\s|6[0-1])|0\.8\.(\d\s|[0]\d?\s|1[0-4]))/.exec(banner);
	if (m) alert('Nginx_buffer_underflow_vulnerability.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(nginx\/(1\.3\.9|1\.4\.0))/.exec(banner);
	if (m) alert('nginx_CVE-2013-2028.xml', m[1]);
	/*-----------------------------------------------------------------------------------------------------------*/	
	m = /(nginx\/1\.([345])\.([0-9]+))/.exec(banner);
		if (m){
		if(m[2]==3) alert('nginx_CVE-2014-0133.xml', m[1]);
		else 
		if(m[2]==4 && parseInt(m[3])<7) alert('nginx_CVE-2014-0133.xml', m[1]);
		else 
		if(m[2]==5 && parseInt(m[3])<12) alert('nginx_CVE-2014-0133.xml', m[1]);
	}
	/*-----------------------------------------------------------------------------------------------------------*/	
}
// other tests
// IBM Tivoli Access Manager
	var m = null;
	
	m = /(WebSeal\/([56]\.0.*|))\s/.exec(banner);
	if (m) alert('IBM_Tivoli_Directory_Traversal.xml', m[1]);
/*-----------------------------------------------------------------------------------------------------------*/	
if (isJava || debug) {
	banner = si.getValue('${WebServerBanner}');
	
	if (debug) banner = "Jetty/5.1.12 (Linux/2.6.18-371.11.1.el5.centos.plus amd64 java/1.6.0_34 ";
	
	m = /(java\/([\d\.\_]+))/.exec(banner);
	if (m) {
		alert("JVM_version_leak_in_Server_Header.xml", m[1]);
	}
}
